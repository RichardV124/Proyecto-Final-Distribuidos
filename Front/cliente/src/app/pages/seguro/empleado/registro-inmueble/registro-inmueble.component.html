<section class="breadcumb-area bg-img" style="background-image: url(https://colorlib.com/preview/theme/south/img/bg-img/hero4.jpg);">
  <div class="container h-100">
    <div class="row h-100 align-items-center">
      <div class="col-12">
        <div class="breadcumb-content">
          <h3 class="breadcumb-title">Gestión de inmuebles</h3>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="container">
  <div class="row">

    <div class="aviso alert alert-danger" style="margin: 15px 0 0 0;" *ngIf="show == 404">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>
    <div class="aviso alert alert-success" style="margin: 15px 0 0 0;" *ngIf="show == 505">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>

    <div class="card mt-4" style="width: 100%;">
      <div class="card-body" style="width: 100%;">

        <div class="form-group">
          <div class="row">
            <div class="col-md-2"><label>Matrícula</label></div>
            <div class="col-md-8">
              <input type="text" [(ngModel)]="selectedInmueble.matricula" placeholder="Ingrese la matrícula del inmueble que desea buscar"
                class="form-control">
            </div>
            <div class="col-md-2">
              <button (click)="buscar()" class="btn south-btn btn-2 m-1">
                Buscar
              </button>
            </div>
          </div>
        </div>

        <div class="panel single-accordion">
          <h6><a role="button" class="collapsed" aria-expanded="true" aria-controls="collapseOne" data-toggle="collapse"
              data-parent="#accordion" href="#collapseOne">DE CLIC AQUÍ PARA REGISTRAR, EDITAR O VER LOS DATOS DE UN
              INMUEBLE
              <span class="accor-open"><i class="fa fa-plus" aria-hidden="true"></i></span>
              <span class="accor-close"><i class="fa fa-minus" aria-hidden="true"></i></span>
            </a></h6>
          <div id="collapseOne" class="accordion-content collapse">

            <div class="col-12">
              <br>
              <div class="south-tabs-content">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="tab--1" data-toggle="tab" href="#tab1" role="tab" aria-controls="tab1"
                      aria-selected="false">Datos inmueble</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="tab--2" *ngIf="mostrarFotos() == true" data-toggle="tab" href="#tab2" role="tab"
                      aria-controls="tab2" aria-selected="false">Fotos y videos</a>
                  </li>
                </ul>

                <div class="tab-content mb-100" id="myTabContent">
                  <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab--1">
                    <div class="south-tab-content">
                      <!-- Tab Text -->
                      <div class="south-tab-text">
                        <div class="form-group">
                          <div class="row">
                            <div class="col-md-2"><label>Publicación en</label><span style="color: red">*</span></div>
                            <div class="col-md-2">
                              <input type="checkbox" [(ngModel)]="publicarEnArriendo" name="">Arriendos
                            </div>
                            <div class="col-md-2">
                              <input type="checkbox" [(ngModel)]="publicarEnVenta" name="">Ventas
                            </div>
                          </div> <br>
                          <div class="row">
                            <div class="col-md-2"><label>Cédula propietario</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="text" [(ngModel)]="propietario.cedula" placeholder="Ingrese el número de cédula del propietario"
                                class="form-control" required="required">
                            </div>
                            <div class="col-md-2"><label>Matrícula</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="text" [(ngModel)]="selectedInmueble.matricula" placeholder="Ingrese la matrícula del inmueble"
                                class="form-control">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Tipo de inmueble</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <select [(ngModel)]="selectedTipoInmueble.id" class="form-control">
                                <option [ngValue]="0" selected disabled hidden>Seleccione el tipo de inmueble</option>
                                <option *ngFor="let tp of listaTiposInmueble" [value]="tp.id">{{tp.descripcion}}</option>
                              </select>
                            </div>
                            <div class="col-md-2"><label>Zona</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <select class="form-control" [(ngModel)]="selectedInmueble.zona">
                                <option [ngValue]="0" selected disabled hidden>Seleccione la zona del inmubele</option>
                                <option [ngValue]="1">Rural</option>
                                <option [ngValue]="2">Urbano</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Dirección</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="text" [(ngModel)]="selectedInmueble.direccion" placeholder="Ingrese la dirección"
                                class="form-control" required="required">
                            </div>
                            <div class="col-md-2"><label>Area</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="1" [(ngModel)]="selectedInmueble.area" placeholder="Ingrese el área en m^2"
                                class="form-control" required="required">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Precio</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="100000" [(ngModel)]="selectedInmueble.valor" placeholder="Ingrese el precio"
                                class="form-control" required="required">
                            </div>
                            <div class="col-md-2"><label>Porcentaje Promoción</label></div>
                            <div class="col-md-4">
                              <input type="number" min="0" [(ngModel)]="selectedInmueble.promocion" placeholder="Ingrese un porcentaje de promoción"
                                class="form-control">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Habitaciones</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="1" [(ngModel)]="selectedInmueble.num_habitaciones" required="required"
                                placeholder="Ingrese el número de habitaciones" class="form-control">
                            </div>
                            <div class="col-md-2"><label>Baños</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="1" [(ngModel)]="selectedInmueble.num_banios" required="required"
                                placeholder="Ingrese el número de baños" class="form-control">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Pisos</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="1" [(ngModel)]="selectedInmueble.pisos" required="required"
                                placeholder="Ingrese la cantidad de pisos del inmueble" class="form-control">
                            </div>
                            <div class="col-md-2"><label>Garajes</label></div>
                            <div class="col-md-4">
                              <input type="number" min="0" [(ngModel)]="selectedInmueble.garaje" placeholder="Ingrese la cantidad de garajes del inmueble"
                                class="form-control">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Closets</label></div>
                            <div class="col-md-4">
                              <input type="number" min="0" [(ngModel)]="selectedInmueble.num_closets" placeholder="Ingrese la cantidad de closets del inmueble"
                                class="form-control">
                            </div>
                            <div class="col-md-2"><label>Cocinas</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <input type="number" min="1" [(ngModel)]="selectedInmueble.num_cocinas" placeholder="Ingrese la cantidad de cocinas del inmueble"
                                class="form-control">
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Departamento<span style="color: red">*</span></label></div>
                            <div class="col-md-4">
                              <select [(ngModel)]="selectedDepartamento.id" class="form-control" (change)="listarMunicipios()">
                                <option [ngValue]="0" selected disabled hidden>Seleccione un Departamento</option>
                                <option *ngFor="let dpto of listaDepartamentos" [value]="dpto.id">{{dpto.nombre}}</option>
                              </select>
                            </div>
                            <div class="col-md-2"><label>Municipio</label><span style="color: red">*</span></div>
                            <div class="col-md-4">
                              <select [(ngModel)]="selectedMunicipio.id" class="form-control">
                                <option [ngValue]="0" selected disabled hidden>Seleccione un Municipio</option>
                                <option *ngFor="let ms of listaMunicipios" [value]="ms.id">{{ms.nombre}}</option>
                              </select>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-2"><label>Observaciones</label></div>
                            <div class="col-md-10">
                              <textarea [(ngModel)]="selectedInmueble.observaciones" placeholder="Ingrese los comentarios que desee acerca del inmueble"
                                class="form-control"></textarea>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-md-12">
                              <div class="upload-btn-wrapper">
                                <button id="btnArchivo">ELEGIR ARCHIVOS</button>
                                <input type="file" id="file" multiple name="myfile" (change)="onFileSelected($event)" />
                                <input for="file" [(ngModel)]="labelFile" readonly style="border: 0; margin-left: 10px; width: 60%;" />
                              </div>
                            </div> 
                          </div> <br><br>
                          <!--<div class="row">
                            <div class="col-md-12">
                              <input type="file" class="form-control" [(ngModel)]="selectedFile" multiple (change)="onFileSelected($event)">
                            </div>
                          </div> -->
                          <div class="row">
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.cocina_integral">Cocina
                              integral
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.conjunto_cerrado">Conjunto
                              cerrado
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.salon_comunal">Salon
                              Comunal
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.zonas_verdes">Zonas
                              Verdes
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.seguridad">Seguridad
                              Privada
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.zona_para_ninios">Zona
                              para niños
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.alarma">Alarma
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.energia">Energia
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.alcantarillado">Alcantarillado
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.gas">Gas
                              residencial
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.precio_negociable">Precio
                              Negociable
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.gimnasio">Gimnasio
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.terraza">Terraza
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.balcon">Balcón
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.piscina">Piscina
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.sauna">Sauna
                            </div>
                            <div class="col-md-4">
                              <input type="checkbox" [(ngModel)]="selectedInmueble.zonabbq">Zona
                              BBQ
                            </div>
                          </div> <br>
                          <label>Ubicación del inmueble</label><span style="color: red">*</span> <br>
                          <agm-map [zoom]="8" [latitude]="latitudDefecto" [longitude]="longitudDefecto" (mapClick)="onChoseLocation($event)">
                            <agm-marker *ngIf="marcadorAgregado"  [latitude]="selectedInmueble.latitud" [longitude]="selectedInmueble.longitud"></agm-marker>
                          </agm-map>
                        </div>
                      </div>
                      <div style="float: right">
                        <button (click)="registrar()" class="btn south-btn m-1">
                          Registrarr
                        </button>
                        <button (click)="editar()" class="btn south-btn btn-3 m-1">
                          Editar
                        </button>
                        <button (click)="limpiarCampos()" class="btn south-btn btn-2 m-1">
                          Limpiar Campos
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab--2">
                    <div class="south-tab-content">
                      <!-- Tab Text -->
                      <div class="south-tab-text">
                        <div class="form-group">
                          <br>
                          <div *ngFor="let image of selectedFile">
                            <img src='{{image}}' />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- </form> -->

    </div>

    <div class="aviso alert alert-danger" style="margin: 15px 0 0 0;" *ngIf="show == 404">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>
    <div class="aviso alert alert-success" style="margin: 15px 0 0 0;" *ngIf="show == 505">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>

    <br><br>

    <div class="card mt-4" style="width: 100%">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <br>
            <h6>Lista de inmuebles</h6><br>
          </div>
          <div class="col-md-12" style="overflow-x:auto; overflow-y:auto;">
            <table class="table" style="width:100%;">
              <thead>
                <tr>
                  <th scope="col">Id</th>
                  <th scope="col">Matrícula</th>
                  <th scope="col">Direccion</th>
                  <th scope="col">Area</th>
                  <th scope="col">Tipo de inmueble</th>
                  <th scope="col">Precio</th>
                  <th scope="col">Promocion</th>
                  <th scope="col">Habitaciones</th>
                  <th scope="col">Baños</th>
                  <th scope="col">Pisos</th>
                  <th scope="col">Garajes</th>
                  <th scope="col">Cocinas</th>
                  <th scope="col">Departamento</th>
                  <th scope="col">Municipio</th>
                  <th scope="col">Ver</th>
                  <th scope="col">Eliminar</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let i of listaInmuebles">
                  <th scope="row">{{i.id}}</th>
                  <td>{{i.matricula}}</td>
                  <td>{{i.direccion}}</td>
                  <td>{{i.area}}</td>
                  <td>{{i.tipo_inmueble_id.descripcion}}</td>
                  <td>{{i.valor}}</td>
                  <td>{{i.promocion}}</td>
                  <td>{{i.num_habitaciones}}</td>
                  <td>{{i.num_banios}}</td>
                  <td>{{i.pisos}}</td>
                  <td>{{i.garaje}}</td>
                  <td>{{i.num_cocinas}}</td>
                  <td>{{i.municipio_id.departamento_id.nombre}}</td>
                  <td>{{i.municipio_id.nombre}}</td>
                  <td><button (click)="ver(i)" class="btn south-btn btn-2 m-1">
                      Ver inmueble
                    </button></td>
                  <td><button (click)="eliminar(i)" class="btn south-btn active m-1">
                      Eliminar
                    </button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="aviso alert alert-danger" style="margin: 15px 0 0 0;" *ngIf="show == 404">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>
    <div class="aviso alert alert-success" style="margin: 15px 0 0 0;" *ngIf="show == 505">
      <div id="close" title="Cerrar" (click)="cerrarMsj()">x</div>{{respuesta.msj}}
    </div>

    <div class="card mt-4" style="width: 100%;">
      <div class="card-body">
        <agm-map [zoom]="8" [latitude]="latitudDefecto" [longitude]="longitudDefecto">
          <ng-container>
            <agm-marker (markerClick)="ver(e)" *ngFor="let e of listaInmuebles" [latitude]="e.latitud" [longitude]="e.longitud">
              <agm-info-window>
                <strong>Direccion: {{e.direccion}}</strong><br>
                <!--<strong>Propietario: {{e.cliente_cedula.nombre}}</strong>-->
              </agm-info-window>
            </agm-marker>
          </ng-container>
        </agm-map>
      </div>
    </div>

  </div> <br>
</div>
